Introdução a análise de Malware

Artefatos

https://drive.proton.me/urls/3J2RFFV99M#9c8H4hcQO2JB
senha: blueTeam

Usar arquivo backdoor.exe (malware)

Na VM Linux: Terminal

Examinar o tipo de arquivo
  file backdoor.exe

Examinar strings
  strings backdoor.exe

Calcular Hashes
  md5sum backdoor.exe
  sha1sum backdoor.exe
  sha256sum backdoor.exe

Na VM Windows: PowerShell

Examinar o tipo de arquivo
  file backdoor.exe

Examinar strings
  Select-String -Pattern 'string' -Path .\backdoor.exe

Calcular Hashes
  Get-FileHash .\backdoor.exe -Algorithm MD5
  Get-FileHash .\backdoor.exe -Algorithm SHA1
  Get-FileHash .\backdoor.exe -Algorithm SHA256

O Virus Total é um serviço online que analisa arquivos e URLs suspeitos para detectar tipos de malware e conteúdo malicioso usando mecanismos de antivírus.
https://www.virustotal.com/gui/home/upload
  Upload do arquivo 
https://www.virustotal.com/gui/home/search
  hash

---
Qual é o md5sum deste sample?
Qual é a data de criação deste sample?
---

Sobre arquivos Portable Executable (PE) 

PE Header
  O cabeçalho do arquivo PE contém os metadados sobre um arquivo executável portátil. Esses dados podem nos ajudar a encontrar muitas informações úteis para nossa análise.

PE Tree é um módulo Python para visualizar arquivos PE em uma visualização em árvore usando pefile.
  Intalação:
    git clone https://github.com/blackberry/pe_tree.git
    cd pe_tree
    python3 -m venv env
    source ./env/bin/activate
    pip install -e .

  Execução: 
    pe-tree

Um arquivo PE é dividido em diferentes seções, com finalidades distintas. 
  .text: Esta seção geralmente contém as instruções da CPU executadas quando o arquivo PE é executado. Esta seção é marcada como executável.
  .data: Esta seção contém as variáveis ​​globais e outros dados globais usados ​​pelo arquivo PE.
  .rsrc: Esta seção contém recursos usados ​​pelo arquivo PE, por exemplo, imagens, ícones etc.

---
Análise Dinâmica Básica

Cuidado!
A análise dinâmica requer a execução de amostras de malware ativas, que podem ser destrutivas. É altamente recomendável que você execute a análise de malware em uma Máquina Virtual isolada. Você pode criar um snapshot limpo da sua Máquina Virtual antes de executar qualquer análise de malware e revertê-la para um estado anterior novamente após cada análise. Não execute análises de malware em uma máquina ativa que não tenha sido desenvolvida especificamente para análise de malware.

Open Source Sandboxes

https://github.com/cuckoosandbox/cuckoo
https://github.com/kevoreilly/CAPEv2

Online Sandboxes:

https://cuckoo.cert.ee/
https://any.run/
https://analyze.intezer.com/
https://hybrid-analysis.com/

Hash MD5 - Wannacry
84c82835a5d21bbcf75a61706d8ab549

Quickpost: About the Physical and Logical Structure of PDF Files
https://blog.didierstevens.com/2008/04/09/quickpost-about-the-physical-and-logical-structure-of-pdf-files/
---

Laboratório prático

PDFiD
O PDFiD verificará um documento PDF em busca de uma determinada lista de sequências de caracteres e contará as ocorrências (total e ofuscadas), permitindo que você identifique documentos PDF que contenham, por exemplo JavaScript e/ou executem uma ação quando abertos.

PDF parsing
A análise de PDF é uma abordagem popular para extrair texto, tabelas, imagens ou campos de dados de documentos PDF.

Prática: diretório Pratica 

Modulo 4 - LAB - Analisando Artefato.pdf
Modulo 4 - LAB - Analisando PDF.pdf


---
Desafios

1) CVE
Analise o artefato - desafio1.pdf - e descubra se existem informações relacionadas a alguma CVE. Em seguida responda: 
a) Qual é a CVE.
b) Qual é a data da CVE.
c) Em qual stream foi encontrada.


2) QUAL É A URL
Analise o artefato - desafio2.pdf - e descubra qual site está relacionado ao malware. 

3) ANÁLISE BÁSICA DE HEADER DE E-MAIL
Artefato caso1.eml
a) De acordo ao IP, qual país está associado ao servidor de envio de email?
b) se o Leoncio responder esse e-mail, para qual endereço de e-mail sua resposta será enviada?
c) Qual o valor do cabeçalho personalizado no e-mail?
